# Local Development Configuration
# Copy this file to .env.local and fill in your actual values

# Database (Cloud SQL via Proxy or local PostgreSQL)
DATABASE_URL=postgresql://rag_user:your-password@localhost:5432/rag_db

# GCP Configuration
GCP_PROJECT_ID=your-gcp-project-id
GCP_REGION=us-central1
GCS_BUCKET=your-project-id-rag-documents

# GCS Connection Pool (controls concurrent upload/download operations)
# Must match urllib3 connection pool size (default: 10)
# Increase only if experiencing bottlenecks with large documents
GCS_CONNECTION_POOL_SIZE=10

# Vertex AI
VERTEX_AI_LOCATION=us-central1
EMBEDDING_MODEL=text-embedding-005
EMBEDDING_DIMENSION=1408

# FastAPI
PORT=8080

# Authentication & Authorization
# Comma-separated list of allowed user emails (for whitelist authorization)
ALLOWED_USERS=your-email@example.com

# Trusted service accounts that can delegate via X-End-User-ID header
# Regular users CANNOT use X-End-User-ID to impersonate others (security feature)
# Only these whitelisted service accounts can set X-End-User-ID for service-to-service delegation
# Example: TRUSTED_SERVICE_ACCOUNTS=backend-sa@project.iam.gserviceaccount.com,api-gateway@project.iam.gserviceaccount.com
# For testing/development: Add your test user email to allow X-End-User-ID in tests
TRUSTED_SERVICE_ACCOUNTS=

# JWT Configuration (OIDC-compliant providers)
# Default values are for Google Identity Platform
# For other providers, update these URLs:

# JWKS endpoint (public keys for JWT signature verification)
# Google: https://www.googleapis.com/oauth2/v3/certs
# Azure AD: https://login.microsoftonline.com/{tenant}/discovery/v2.0/keys
# Auth0: https://{domain}/.well-known/jwks.json
# Okta: https://{domain}/oauth2/default/v1/keys
JWKS_URL=https://www.googleapis.com/oauth2/v3/certs

# Expected token issuer (iss claim)
# Google: https://accounts.google.com
# Azure AD: https://login.microsoftonline.com/{tenant}/v2.0
# Auth0: https://{domain}/
# Okta: https://{domain}/oauth2/default
ISSUER=https://accounts.google.com

# Expected audience (aud claim) - usually your OAuth2 Client ID
# Get from: https://console.cloud.google.com/apis/credentials
AUDIENCE=your-oauth-client-id.apps.googleusercontent.com

# OAuth Client Secret (only for OAuth flow in scripts/get_user_token.py)
CLIENT_SECRET=your-oauth-client-secret

# Logging
# Supported levels: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Reranking (optional - improves search relevance at cost of latency)
# Enable reranking for better search quality (multi-stage retrieval)
RERANKER_ENABLED=false

# Reranker type: "gemini" (LLM-based, recommended) | "local" (cross-encoder) | "cohere" (API)
# Gemini: Best quality, ~500ms/query, uses Google Cloud AI
# Local: Fast (~100ms), runs in Cloud Run, no API costs, offline-capable
# Cohere: Commercial API, high quality, paid
RERANKER_TYPE=gemini

# Reranker model (type-specific):
# Gemini models (RERANKER_TYPE=gemini, default):
#   - gemini-2.5-flash (RECOMMENDED: stable, production-ready, Dec 2025)
#   - gemini-2.0-flash-exp (experimental, may change)
#   - gemini-1.5-flash (deprecated, use 2.5)
# Local models (RERANKER_TYPE=local):
#   - cross-encoder/ms-marco-MiniLM-L-12-v2 (120MB, fast, good)
#   - BAAI/bge-reranker-base (1.1GB, better quality)
#   - BAAI/bge-reranker-large (1.4GB, best quality)
# Cohere models (RERANKER_TYPE=cohere):
#   - rerank-english-v3.0 (best for English)
#   - rerank-multilingual-v3.0 (100+ languages)
RERANKER_MODEL=gemini-2.5-flash

# LLM Extraction (for summary + keywords generation during upload)
# Used for BM25 hybrid search metadata extraction
# Recommended: gemini-2.5-flash-lite (cheapest, $0.10/1M input + $0.40/1M output)
# Cost: ~$0.000225 per document (~$2.25 per 10K docs, 4.2x cheaper than flash)
# Alternative: gemini-2.5-flash ($9.35 per 10K docs, better quality for complex docs)
LLM_EXTRACTION_MODEL=gemini-2.5-flash-lite

# Google Cloud configuration (required for RERANKER_TYPE=gemini)
# Set if different from GCP_PROJECT_ID above
# GOOGLE_CLOUD_PROJECT=your-gcp-project-id
# GOOGLE_CLOUD_LOCATION=us-central1

# Cohere API key (only needed if RERANKER_TYPE=cohere)
# COHERE_API_KEY=your-cohere-api-key

# OAuth tokens (auto-generated by scripts/get_user_token.py, do not edit manually)
# ID_TOKEN=...
# REFRESH_TOKEN=...
