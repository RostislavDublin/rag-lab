# Production Configuration Example (for Cloud Run Deployment)
# This file contains production deployment configuration template
# For local development, copy .env.local.example to .env.local and configure it

# ===== Database Configuration =====
# Cloud SQL connection via Unix socket (Cloud Run uses Cloud SQL Proxy built-in)
DATABASE_URL=postgresql+asyncpg://rag_user:your-password@/rag_db?host=/cloudsql/your-project:us-central1:rag-postgres

# ===== GCP Configuration =====
GCP_PROJECT_ID=your-gcp-project-id
GCP_REGION=us-central1
GCS_BUCKET=your-project-id-rag-documents
CLOUD_SQL_CONNECTION_NAME=your-project-id:us-central1:rag-postgres
SERVICE_ACCOUNT_EMAIL=rag-service@your-project-id.iam.gserviceaccount.com

# ===== Vertex AI Configuration =====
VERTEX_AI_LOCATION=us-central1
EMBEDDING_MODEL=text-embedding-005
EMBEDDING_DIMENSION=768

# ===== GCS Connection Pool =====
# Controls concurrent upload/download operations
# Must match urllib3 connection pool size (default: 10)
GCS_CONNECTION_POOL_SIZE=10

# ===== FastAPI Configuration =====
# Port is set by Cloud Run (always 8080)
PORT=8080

# ===== Logging Configuration =====
# Supported levels: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Production: INFO or WARNING recommended
LOG_LEVEL=INFO

# ===== Reranking Configuration =====
# Enable reranking for better search quality (multi-stage retrieval)
RERANKER_ENABLED=true

# Reranker type: "gemini" (LLM-based, recommended) | "local" (cross-encoder) | "cohere" (API)
RERANKER_TYPE=gemini

# Reranker model for Gemini reranker
# gemini-2.5-flash-lite: RECOMMENDED (cheap $0.10/1M input, reliable)
# gemini-2.5-flash: More expensive but higher quality
RERANKER_MODEL=gemini-2.5-flash-lite

# ===== LLM Extraction Configuration =====
# Used for summary + keywords generation during document upload (for BM25 hybrid search)
# gemini-2.5-flash-lite: RECOMMENDED (cheap $0.10/1M input + $0.40/1M output)
LLM_EXTRACTION_MODEL=gemini-2.5-flash-lite

# ===== Authentication & Authorization =====
# JWT Configuration (OIDC-compliant providers)
# Default: Google Identity Platform

# JWKS endpoint (public keys for JWT signature verification)
JWKS_URL=https://www.googleapis.com/oauth2/v3/certs

# Expected token issuer (iss claim)
ISSUER=https://accounts.google.com

# Expected audience (aud claim) - OAuth2 Client ID
# Get from: https://console.cloud.google.com/apis/credentials
AUDIENCE=your-oauth-client-id.apps.googleusercontent.com

# Comma-separated list of allowed user emails (whitelist authorization)
# Production: Replace with actual production users
ALLOWED_USERS=user1@example.com,user2@example.com

# Trusted service accounts that can use X-End-User-ID delegation
# Production: Add service accounts that need delegation (comma-separated)
# Example: backend-sa@project.iam.gserviceaccount.com,api-gateway@project.iam.gserviceaccount.com
TRUSTED_SERVICE_ACCOUNTS=

# ===== Google Cloud Configuration (for Gemini reranking) =====
# Uses GCP_PROJECT_ID and GCP_REGION from above
# GOOGLE_CLOUD_LOCATION defaults to GCP_REGION

# ===== Cohere Configuration (only if RERANKER_TYPE=cohere) =====
# COHERE_API_KEY=your-cohere-api-key

# ===== OAuth Configuration (NOT used in production Cloud Run!) =====
# CLIENT_SECRET - OAuth client secret (DO NOT SET in production!)
# This is only needed for local scripts/get_user_token.py
# CLIENT_SECRET=your-oauth-client-secret
